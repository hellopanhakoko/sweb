<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Buy {{ item.name }}</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f7f7f7; text-align: center; padding: 50px; }
        .container { background: #fff; padding: 30px; border-radius: 10px; display: inline-block; box-shadow: 0 0 15px rgba(0,0,0,0.1); }
        h1 { color: #333; }
        img { margin: 20px 0; }
        .status { margin-top: 20px; font-size: 1.2em; font-weight: bold; }
        .success { color: green; }
        .failed { color: red; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Buy: {{ item.name }}</h1>
        <p>Price: ${{ "%.2f"|format(item.price) }}</p>

        <div id="qr-container">
            <img src="data:image/png;base64,{{ qr_code }}" alt="Scan QR to Pay">
        </div>

        <div class="status" id="status">Waiting for payment...</div>
    </div>

    <script>
        const md5 = "{{ md5 }}";

        async function checkPayment() {
            try {
                const res = await fetch(`/status/${md5}`);
                const data = await res.json();
                const statusEl = document.getElementById("status");

                if(data.status === "pending") {
                    statusEl.textContent = "Waiting for payment...";
                } else if(data.status === "success") {
                    statusEl.textContent = data.message;
                    statusEl.className = "status success";
                    document.getElementById("qr-container").style.display = "none";
                } else if(data.status === "failed") {
                    statusEl.textContent = data.message;
                    statusEl.className = "status failed";
                    document.getElementById("qr-container").style.display = "none";
                }
            } catch (err) {
                console.error(err);
            }
        }

        setInterval(checkPayment, 5000);
        checkPayment();
    </script>
</body>
</html>
